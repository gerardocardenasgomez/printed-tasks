# printed-tasks

I am currently working on a React-based front-end that will make creating tasks a lot easier!

Printed-Tasks aims to print tasks to a receipt printer. It makes it more fun to be productive AND also makes it into something that can't easily be ignored because you can put a printed task receipt on your face to help you focus. :-)

My workflow so far is:

1. Run the `printed_script.py` script to create a task.
2. Put the printed task on a whiteboard for tracking IRL
3. Mark a task as completed by scanning it with an iOS Shortcut

There are a million components if you want to get the full experience but you really only need:

- Arduino with Wi-fi
- A Receipt Printer that is ESC/POS compatible

If you want the full experience you will also need:

- Google Gemini Account (Free)
- Supabase Account (Free)
- Some way to scan barcodes (Maybe Free)

### Arduino Setup

I am not very good at C++ so I will fix all this later and clean up all the code -- been mainly focused on getting a working version!

Two files you need are included in `arduino_code`. You might need to rename the `#include "thingProperties.h"` include as this will depend on what you call your cloud thing -- you also don't need the cloud bit as long as you have a computer you can upload code to. That file is generated by IoT Cloud.

The Arduino code runs an HTTP server that listens on port 80 and supports these endpoints:

- `/` -> prints Server info and some help stuff
- `/print?text=<text>` -> Will send whatever text is in the `text` URL param to the printer after url decoding a bunch of characters. There are some still missing, I think. Working on this!
- `/barcode?barcode=<task_barcode_id>` -> Will send the text in the `barcode` URL param to the printer, after dumping it to hex and converting everything to numbers. I currently only know how to print barcodes to `CODE128` that are numeric only. The UUID version is tough! But I will work on this.
- `/cut` -> Will send a cut command to the printer. Useful if you wanna make your own jams. Write a script to send whatever you want to `/print` and then finish it off with a `/cut`.
- `/barcode/uuid_static_test` -> This is a testing endpoint while I try to figure out the ESC/POS stuff.

### printed_script.py

This is a commandline script you can use:

```
$ python3 printed_script.py -n "<task name>" -d "<task description>" -p "<task priority>"
```

Here's an example:

```
$ python3 printed_script.py -n "Printed Tasks README 1" -d "Update the README on my printed-tasks repo to include documentation for setup and usage" -p "LOW"
```


This script requires that your config.ini include this:

```
[API]
URL = http://192.168.0.1
```

Replace the URL with the URL for your Arduino HTTP server. You can enable the other sections (`GOOGLE` | `SUPABASE` | `BARCODE_API`) if you want additional functionality, otherwise this should be enough to print tasks to a receipt printer with ESC / POS capabilities.

### Google / Gemini Integration

To add a Google AI thing you need to go to: https://aistudio.google.com/

Click on GET API key

Most of the models have a free tier. I set up one that has a generous free tier and that's good enough for generating some encouraging message about the task you create. Feel free to edit the AI prompt if you want! That's going to be in `/utils/ai_utils.py` somewhere around Line 20.

There's currently an issue where the AI's response gets cut off when printed on the receipt. I think that's an issue with my splitting code? I will review this. :-)

### Supabase Integration

I'll add the table definition required for this soon. You can cheat and figure it out from the types but I will also include the RLS policies. Maybe terraform a bit? That sounds kinda neat.

### Typescript Barcode API

If you have the correct `config.ini` you should be able to run the Barcode API. Make sure you have `BARCODE_API_KEY` defined in your `config.ini`! Make up whatever you want, ideally something very secure if you want this available online somewhere. For private use, pick something decent still!

The main purpose of this is to take in a `task_barcode_id` and mark that task as complete in Supabase. It will update two columns: `task_completed = TRUE` and `task_completed_on = now()`.

The API has two endpoints:

- `/` -> Lets you know that the server is running and working.
- `/barcode/<BARCODE_API_KEY>/<task_barcode_id>` -> The `BARCODE_API_KEY` is for authenticating with this API. The `task_barcode_id` should exist in Supabase.

Set this up by running the `run_ts_api_container.sh` script in `ts_api`. You will need `Docker` installed and running, and you will also need to pass the location of your `config.ini` to the script:

```
./run_ts_api_container.sh ../config.ini
```

The script will extract the variables from `config.ini` and pass them to the container as environment variables.

The API is yappy on purpose in case you need to debug something like the iOS Shortcut later, or your own barcode scanner if you want. Some paid barcode scanners on the Android / iOS store will let you scan a barcode and send it to an API. I don't know if there are any free ones.

### iOS Shortcut / Barcode Scanner

If you want to set up an iOS Shortcut to scan barcodes and send the ID to the Barcode API, here's how you do it:

1. Create Shortcut
2. `Scan QR or barcode` Action
3. `Show <QR/Barcode` Action (Skip this if you want, I just like seeing the barcode ID for debugging purposes)
4. `Get contents of` Action NOTE: URL should be: `"http://<IP_ADDRESS_OF_YOUR_BARCODE_API>:3000/<BARCODE_API_KEY>/"` + `QR/Barcode` (The Variable from the previous action). Replace the IP and `BARCODE_API_KEY` with whatever you have.
5. `Show contents of URL` Action (Skip this if you do not want to see the output from the Barcode API)

I will add a picture later!
